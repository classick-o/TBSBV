<!-- Source: initial-1/TBSBV 4 -->

<!-- Backdrop for expanded state -->
<div id="sticky-backdrop" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-40 hidden opacity-0 transition-opacity duration-300"></div>

<!-- Sticky Consultation Widget -->
<div id="sticky-consultation" class="fixed bottom-8 right-8 z-50 hidden translate-x-full opacity-0 transition-all duration-500">
  <!-- Collapsed State - Floating Button -->
  <button
    id="sticky-cta-button"
    class="group flex items-center gap-3 px-6 py-4 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold shadow-2xl shadow-cyan-500/50 hover:shadow-cyan-500/70 transition-all duration-300 hover:scale-105"
  >
    <div class="w-10 h-10 bg-white/20 flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
    </div>
    <span class="text-lg">Request Consultation</span>
  </button>

  <!-- Expanded State - Contact Card -->
  <div id="sticky-card" class="hidden w-96 bg-white border-2 border-slate-200 shadow-2xl scale-90 opacity-0 transition-all duration-300 origin-bottom-right">
    <!-- Header -->
    <div class="bg-gradient-to-r from-slate-900 to-slate-800 p-6">
      <div class="flex items-start justify-between mb-2">
        <div class="w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-white"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
        </div>
        <button
          id="sticky-close"
          class="text-slate-400 hover:text-white transition-colors"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
      </div>
      <h3 class="text-2xl font-bold text-white mb-2">
        Request a Consultation
      </h3>
      <p class="text-slate-300 text-sm">
        Get expert advice on your security needs
      </p>
    </div>

    <!-- Content -->
    <div class="p-6 space-y-4">
      <div>
        <label class="block text-sm font-semibold text-slate-900 mb-2">
          Full Name *
        </label>
        <input
          type="text"
          placeholder="John Smith"
          class="w-full px-4 py-3 border-2 border-slate-200 focus:border-cyan-500 focus:outline-none transition-colors text-slate-900"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-900 mb-2">
          Email Address *
        </label>
        <input
          type="email"
          placeholder="john@company.com"
          class="w-full px-4 py-3 border-2 border-slate-200 focus:border-cyan-500 focus:outline-none transition-colors text-slate-900"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-900 mb-2">
          Service Interest
        </label>
        <select class="w-full px-4 py-3 border-2 border-slate-200 focus:border-cyan-500 focus:outline-none transition-colors text-slate-900">
          <option>Select a service</option>
          <option>Cyber Investigation</option>
          <option>Due Diligence</option>
          <option>Reputation Management</option>
          <option>Other</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-900 mb-2">
          Brief Description
        </label>
        <textarea
          rows="3"
          placeholder="Tell us about your needs..."
          class="w-full px-4 py-3 border-2 border-slate-200 focus:border-cyan-500 focus:outline-none transition-colors text-slate-900 resize-none"
        ></textarea>
      </div>

      <button class="w-full py-4 bg-gradient-to-r from-cyan-600 to-blue-600 text-white font-bold hover:shadow-xl hover:shadow-cyan-500/30 transition-all">
        Submit Request
      </button>

      <p class="text-xs text-slate-500 text-center">
        100% confidential. We'll respond within 24 hours.
      </p>
    </div>
  </div>
</div>

<script>
  const stickyWidget = document.getElementById('sticky-consultation');
  const stickyButton = document.getElementById('sticky-cta-button');
  const stickyCard = document.getElementById('sticky-card');
  const stickyClose = document.getElementById('sticky-close');
  const stickyBackdrop = document.getElementById('sticky-backdrop');

  let isExpanded = false;

  // Show/hide based on scroll position
  let scrollTicking = false;
  window.addEventListener('scroll', () => {
    if (scrollTicking) return;
    scrollTicking = true;
    requestAnimationFrame(() => {
      scrollTicking = false;
      if (window.scrollY > 400) {
        if (stickyWidget?.classList.contains('hidden')) {
          stickyWidget.classList.remove('hidden');
          requestAnimationFrame(() => {
            stickyWidget.classList.remove('translate-x-full', 'opacity-0');
            stickyWidget.classList.add('translate-x-0', 'opacity-100');
          });
        }
      } else {
        if (!stickyWidget?.classList.contains('hidden') && !isExpanded) {
          stickyWidget.classList.add('translate-x-full', 'opacity-0');
          stickyWidget.classList.remove('translate-x-0', 'opacity-100');
          setTimeout(() => {
            if (window.scrollY <= 400) {
              stickyWidget.classList.add('hidden');
            }
          }, 500);
        }
      }
    });
  }, { passive: true });

  function expandCard() {
    isExpanded = true;
    stickyButton?.classList.add('hidden');
    stickyCard?.classList.remove('hidden');

    // Show backdrop
    stickyBackdrop?.classList.remove('hidden');
    requestAnimationFrame(() => {
      stickyBackdrop?.classList.remove('opacity-0');
      stickyBackdrop?.classList.add('opacity-100');
    });

    // Animate card in
    requestAnimationFrame(() => {
      stickyCard?.classList.remove('scale-90', 'opacity-0');
      stickyCard?.classList.add('scale-100', 'opacity-100');
    });
  }

  function collapseCard() {
    isExpanded = false;

    // Animate card out
    stickyCard?.classList.add('scale-90', 'opacity-0');
    stickyCard?.classList.remove('scale-100', 'opacity-100');

    // Hide backdrop
    stickyBackdrop?.classList.add('opacity-0');
    stickyBackdrop?.classList.remove('opacity-100');

    setTimeout(() => {
      stickyCard?.classList.add('hidden');
      stickyBackdrop?.classList.add('hidden');
      stickyButton?.classList.remove('hidden');
    }, 300);
  }

  stickyButton?.addEventListener('click', expandCard);
  stickyClose?.addEventListener('click', collapseCard);
  stickyBackdrop?.addEventListener('click', collapseCard);
</script>
